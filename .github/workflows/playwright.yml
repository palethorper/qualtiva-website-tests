name: Qualtiva Website Playwright Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    # Run tests daily at 2 AM Sydney/Australia time (AEDT - UTC+11, winter AEST - UTC+10)
    # AEDT (Oct-Apr): 2am Sydney = 3pm UTC previous day
    # AEST (Apr-Oct): 2am Sydney = 4pm UTC previous day
    # Using 15:00 UTC for AEDT coverage (3pm = 2am next day Sydney)
    - cron: '0 15 * * *'

jobs:
  test:
    name: Qualtiva Solutions Website Tests
    runs-on: ubuntu-latest
    
    strategy:
      fail-fast: false
      matrix:
        # Test on latest Node.js version
        node-version: [20]
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Install Playwright browsers
      run: npx playwright install --with-deps
      
    - name: Run all Playwright tests
      run: npm run test:ci
      env:
        # Add any environment variables needed for testing
        CI: true
        BASE_URL: https://www-dev.analytiqa.cloud/
        
    - name: Upload test results
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: playwright-report-${{ matrix.node-version }}
        path: |
          playwright-report/
          test-results/
        retention-days: 30 